// main.js


/**重要事件滚动淡入淡出效果*/
function showimportmentSomething(){
	
	setInterval("statsVisitNum()",8000);
	//statsVisitNum();
	
}
var $first;
function statsVisitNum(){
	
			var time =2000;
			$first=$("#nextli li:eq(0)");
			$("#nextli li:eq(0)").fadeOut(time);
			 setTimeout(function next(){
			 	$("#nextli").append($first);
				$("#nextli li:eq(4)").fadeIn(time);
			 },time);
		
}

/**首页鼠标效果*/
function BindTrMouseEvent(nuber){
	var show={
			"1":"url('../../images/step_indicator_01.png')",
			"2":"url('../../images/step_indicator_02.png')",
			"3":"url('../../images/step_indicator_03.png')",
			"4":"url('../../images/step_indicator_04.png')"
	};
	$("#query_result_table_body tr[name='show']").mouseenter(function(){
		
	    var x = $(this).offset().left;
	    var y = $(this).offset().top;
	    $(this).css("opacity", "0.4");
	    $(".TrOverlay").css("background",show[nuber]);
	    $(".TrOverlay").css("display","block");
	    $(".TrOverlay").css("left",x );
	    $(".TrOverlay").css("top",y );
	  });
	
	
	  $(".TrOverlay").mouseout(function(){
		 
	    $(".TrOverlay").css("display","none");
	    $("#query_result_table_body tr[name='show'] ").css("opacity", "1.0");
	  });
	
	
}




function OnMainPageContentReceived(nuber){
	BindTrMouseEvent(nuber);
}



function OnOperativeIndexUpdate(){
  var health_level = {"4": "healthy", "3": "good", "2": "danger", "1": "severe"};
  var operative_index_query_json = {"reqString":"getAll"};
  var Url="/Rcm/Manage/getLineHealth.do";
  PostJSONQuery(Url,operative_index_query_json,
    function(response){
	  
	// alert(JSON.stringify(response));
      var health_array = response['listHealth'];
      health_array.forEach(
        function (element, index, array) {
          var line = element['lineNo'];
          var state = element['stats'];
          var domID = '#operative_index_' + line;
          $(domID)[0].className = health_level[state];
        });
    });
}

function OnAlertQuery(){
	OnMainPageQuery(query_criteria);
	
}




/**查询按钮*/
function selectData(val0){	
	
	var val1 = $('#condition1').val();
	var val2 = $('#condition2').val();
	var val3 = $('#condition3').val();
	var val4 = $('#condition4').val();
	var val5 = $('#condition5').val();
	var val6 = $('#condition6').val();
	var val7 = $('#condition7').val();
	var val8 = $('#main_page_start_time').val();
	var val9 = $('#main_page_end_time').val();
	

	var query_criteria={"warningType":val1,
						"systemName":val2,
						"lineNo":val3,
						"stationName":val4,
						"equipmentname":val5,
						"warningTypeLevel":val6,
						"statments":val7,
						"startDate":val8,
						"endDate":val9,
						"pageNo":val0
						};
	OnMainPageQuery(query_criteria);
}

/**上一页*/
function backpage(){
	$("#select_all").attr('checked',false);
	var nowpage= $('#main_page_nowpage')[0].innerHTML;
	if(nowpage<=1){
		alert("这是第一页，无法往前");
	}else {
		var backPageNo=nowpage-1;
		selectData(backPageNo);
	}
	
	
}
/**下一页*/
function nextpage(){
	$("#select_all").attr('checked',false);
	var nowpage= $('#main_page_nowpage')[0].innerHTML;
	var totalpage= $('#main_page_totalpage')[0].innerHTML;
	
	if(nowpage>=totalpage){
		alert("这是最后一页，无法往前");
	}else{
		var Page=nowpage-1;
		var nextPageNo=Page+2;
		selectData(nextPageNo);
	}
}



function OnMainPageQuery(query_criteria){
	//alert(query_criteria.warningType);
	if(query_criteria.warningType=="故障告警"){
		$("#alert_prameter").html("故障告警");
	}else if(query_criteria.warningType=="故障预警"){
		$("#alert_prameter").html("故障预警");
	}
  var alert_query_json = {
      "page":{
        "pageCount":"10",
        "pageNo":"1"
      },     
      "query":{
        "endDate":"2099-1-1",
        "equipmentname":"",
        "lineNo":"",
        "startDate":"1990-1-1",
        "stationName":"",
        "statments":"",
        "systemName":"",
        "warningType":"",
        "warningTypeLevel":""
      }
  };
  
  if (query_criteria)
  {
    if (query_criteria.pageNo) {
      alert_query_json.page.pageNo = query_criteria.pageNo;
    }
    if (query_criteria.endDate) {
      alert_query_json.query.endDate = query_criteria.endDate;
    }
    if (query_criteria.startDate) {
      alert_query_json.query.startDate = query_criteria.startDate;
    }
    if (query_criteria.equipmentname) {
        alert_query_json.query.equipmentname = query_criteria.equipmentname;
      }
    if (query_criteria.lineNo) {
        alert_query_json.query.lineNo = query_criteria.lineNo;
      }
    if (query_criteria.stationName) {
        alert_query_json.query.stationName = query_criteria.stationName;
      }
    if (query_criteria.statments) {
        alert_query_json.query.statments = query_criteria.statments;
      }
    if (query_criteria.systemName) {
        alert_query_json.query.systemName = query_criteria.systemName;
      }
    if (query_criteria.warningType) {
        alert_query_json.query.warningType = query_criteria.warningType;
      }
    if (query_criteria.warningTypeLevel) {
        alert_query_json.query.warningTypeLevel = query_criteria.warningTypeLevel;
      }
  }
  var Url="/Rcm/Manage/getWaringList.do";
 //alert(JSON.stringify(query_criteria));
  PostJSONQuery(Url,alert_query_json,function(response){
	 // alert(JSON.stringify(response));
	  $('#alert_count')[0].innerHTML = response["totalCount"];
	  $('#main_page_totalpage')[0].innerHTML = response["totalPage"];
	  var pageNo = alert_query_json.page.pageNo; 
	  $('#main_page_nowpage')[0].innerHTML = pageNo;
	   
	  var warningList=response.warningList;
	  $('#query_result_table_body tr').remove();
	  for(var i=0;i<warningList.length;i++){
		  var statmentsnumber= warningList[i]["statments"];
		  
		  //0 未处理 123 确认中 4 已处理 5 已取消
		  var stat="";
		  if(statmentsnumber==0){
			  stat="未处理";
		  }
		  if(statmentsnumber==1||statmentsnumber==2||statmentsnumber==3){
			  stat="确认中";
		  }
		  if(statmentsnumber==4){
			  stat="已处理";
		  }
		  if(statmentsnumber==5){
			  stat="已取消";
		  }
		  var status={
				  	"4": "<img src='../../images/none.gif' />", 
				  	"3": "<img src='../../images/blue.gif' />", 
				  	"2": "<img src='../../images/yellow.gif' />", 
				  	"1": "<img src='../../images/red.gif' />"
					};
		  var warningtLevel={"1":"一级","2":"二级","3":"三级","4":"四级"};
		  var page=pageNo;
		var leve=warningList[i]["warningTypeLevel"];
		var checkBox=null;
		var onmouse=null;
		if(stat=="未处理"){
			checkBox="</label><input   id='"+warningList[i]["id"]+"' name='needitems' type='checkbox'/></td >";
			onmouse="<tr style='height:26px'   >";
		}else{
			checkBox="</label><input   name='items' disabled='disabled'  type='checkbox'/></td >";
			onmouse="<tr  style='height:26px' name='show'  onmouseover='OnMainPageContentReceived("+statmentsnumber+");' >";
		}
			
		  $('#query_result_table_body').append("" +
				  onmouse +
		  		"<td ><div>"+status[warningList[i]["warningTypeLevel"]]+"</div></td>" +
		  		"<td >" +
		  		"<label for='select_all'>" +
		  		checkBox +
		  		"<td   >"+(((page-1)*10)+1+i)+"</td >" +
		  		"<td   >"+warningList[i]["warningId"]+"</td >" +
		  		"<td   >"+warningList[i]["equipmentId"]+"</td >" +
		  		"<td   >"+warningList[i]["equipmentname"]+"</td >" +
		  		"<td   >"+warningList[i]["systemName"]+"</td >" +
		  		"<td scope='col' >"+
		  		"<span   onmouseover='showDetail_text(true,this);' onmouseout='showDetail_text(false,this);'>"+warningList[i]["equipmentDescription"].substring(0,5)+"..."+"</span>"+
		  		"<div class='detail_info'>"+
		  		"<textarea style='height:150px; width:250px;'rows='6' cols='1'>"+warningList[i]["equipmentDescription"]+
		  		"</textarea>"+
		  		"</div>"+
		  		"</td>" +
		  		"<td   >"+warningList[i]["lineNo"]+"</td >" +
		  		"<td   >"+warningList[i]["stationName"]+"</td >" +
		  		"<td   >"+warningList[i]["warningType"]+"</td >" +
		  		"<td   >"+warningtLevel[warningList[i]["warningTypeLevel"]]+"</td >" +
		  		"<td scope='col' >"+
		  		"<span   onmouseover='showDetail_text(true,this);' onmouseout='showDetail_text(false,this);'>"+warningList[i]["warninginfo"].substring(0,5)+"..."+"</span>"+
		  		"<div class='detail_info'>"+
		  		"<textarea style='height:150px; width:250px;'rows='6' cols='1'>"+warningList[i]["warninginfo"]+
		  		"</textarea>"+
		  		"</div>"+
		  		"</td>" +
		  		"<td   >"+warningList[i]["warningDate"]+"</td >" +
		  		"<td   >"+stat+"</th>" +
		  		"</tr>");
		  
	  } 
    });  
}

/**选中或者撤销当前页所有未处理的序号*/
function CheckboxSelect(){
	var ids=document.getElementById("select_all");
	if(ids.checked){
		$("input[name='needitems']").attr('checked',true);
	}else{
		$("input[name='needitems']").attr('checked',false);
	}
}





















function GetAlertCountPerLine(domName)
{
  var alert_count_query = {"reqString":"get"};
  var Url="/Rcm/Manage/getWarningCounting.do";
  PostJSONQuery(Url,alert_count_query,
    function(response){
      var result = [];
      var alert_count_per_line = {};
      alert_count_per_line.key = "告警数量";
      alert_count_per_line.values = [];
      response.lineCounts.forEach(
        function (element, index, array) {
          var line = element['lineNo'];
          var count = element['count'];
          var fan_piece = {};
          fan_piece.label = line;
          fan_piece.value = parseInt(count, 10);
          if (isNaN(fan_piece.value))
          {
            fan_piece.value = 0;
          }
          alert_count_per_line.values[index] = fan_piece;
        }
      );

      result[0] = alert_count_per_line;
      initPieChart(domName, result, '');
    });  
}


function GetAlertCountPerLevel(domName)
{
  var alert_count_query = {"reqString":"get"};
  var Url="/Rcm/Manage/getWarningCounting.do";
  PostJSONQuery(Url,alert_count_query,
    function(response){
      var result = [];
      var alert_count_per_level = {};
      alert_count_per_level.key = "告警数量";
      alert_count_per_level.values = [];
      response.levelCounts.forEach(
        function (element, index, array) {
          var level = element['level'];
          var count = element['count'];
          var fan_piece = {};
          fan_piece.label = level;
          fan_piece.value = parseInt(count, 10);
          if (isNaN(fan_piece.value))
          {
            fan_piece.value = 0;
          }
          alert_count_per_level.values[index] = fan_piece;
        }
      );

      result[0] = alert_count_per_level;
      initPieChart(domName, result, '');
    });
 
}

function GetAlertCountHistoryPerLevel(domName)
{
  var alert_count_query = {"reqString":"get"};
  var Url="/Rcm/Manage/getWarningCounting.do";
  PostJSONQuery(Url,alert_count_query,
    function(response){
      var result = [];

      response.levelHistory.lines.forEach(
        function (element, index, array) {
          var alert_count_history_per_level = {};
          alert_count_history_per_level.key = element.level;
          alert_count_history_per_level.values = [];
          element.count.forEach(
            function(elementCount, indexCount, arrayCount){
              alert_count_history_per_level.values[indexCount] = {x: indexCount + 1,y: parseInt(elementCount)};
              if (isNaN(alert_count_history_per_level.values[indexCount].y))
              {
                alert_count_history_per_level.values[indexCount].y = 0;
              }
            }
          );

          result[index] = alert_count_history_per_level;
		//alert("result="+ result[0].values[1].x +","+ result[0].values[1].y);
        }
      );
          //alert("result="+ JSON.stringify(result));
      initAlertHistoryChart(domName, result);
    });
  
}

var reportTrend = [
  {
    "key" : "健康指数",
    "bar": true,
    "values" : [ [ 1136005200000 , 1271000.0] , [ 1138683600000 , 1271000.0] , [ 1141102800000 , 1271000.0] , [ 1143781200000 , 0] , [ 1146369600000 , 0] , [ 1149048000000 , 0] , [ 1151640000000 , 0] , [ 1154318400000 , 0] , [ 1156996800000 , 0] , [ 1159588800000 , 3899486.0] , [ 1162270800000 , 3899486.0] , [ 1164862800000 , 3899486.0] , [ 1167541200000 , 3564700.0] , [ 1170219600000 , 3564700.0] , [ 1172638800000 , 3564700.0] , [ 1175313600000 , 2648493.0] , [ 1177905600000 , 2648493.0] , [ 1180584000000 , 2648493.0] , [ 1183176000000 , 2522993.0] , [ 1185854400000 , 2522993.0] , [ 1188532800000 , 2522993.0] , [ 1191124800000 , 2906501.0] , [ 1193803200000 , 2906501.0] , [ 1196398800000 , 2906501.0] , [ 1199077200000 , 2206761.0] , [ 1201755600000 , 2206761.0] , [ 1204261200000 , 2206761.0] , [ 1206936000000 , 2287726.0] , [ 1209528000000 , 2287726.0] , [ 1212206400000 , 2287726.0] , [ 1214798400000 , 2732646.0] , [ 1217476800000 , 2732646.0] , [ 1220155200000 , 2732646.0] , [ 1222747200000 , 2599196.0] , [ 1225425600000 , 2599196.0] , [ 1228021200000 , 2599196.0] , [ 1230699600000 , 1924387.0] , [ 1233378000000 , 1924387.0] , [ 1235797200000 , 1924387.0] , [ 1238472000000 , 1756311.0] , [ 1241064000000 , 1756311.0] , [ 1243742400000 , 1756311.0] , [ 1246334400000 , 1743470.0] , [ 1249012800000 , 1743470.0] , [ 1251691200000 , 1743470.0] , [ 1254283200000 , 1519010.0] , [ 1256961600000 , 1519010.0] , [ 1259557200000 , 1519010.0] , [ 1262235600000 , 1591444.0] , [ 1264914000000 , 1591444.0] , [ 1267333200000 , 1591444.0] , [ 1270008000000 , 1543784.0] , [ 1272600000000 , 1543784.0] , [ 1275278400000 , 1543784.0] , [ 1277870400000 , 1309915.0] , [ 1280548800000 , 1309915.0] , [ 1283227200000 , 1309915.0] , [ 1285819200000 , 1331875.0] , [ 1288497600000 , 1331875.0] , [ 1291093200000 , 1331875.0] , [ 1293771600000 , 1331875.0] , [ 1296450000000 , 1154695.0] , [ 1298869200000 , 1154695.0] , [ 1301544000000 , 1194025.0] , [ 1304136000000 , 1194025.0] , [ 1306814400000 , 1194025.0] , [ 1309406400000 , 1194025.0] , [ 1312084800000 , 1194025.0] , [ 1314763200000 , 1244525.0] , [ 1317355200000 , 475000.0] , [ 1320033600000 , 475000.0] , [ 1322629200000 , 475000.0] , [ 1325307600000 , 690033.0] , [ 1327986000000 , 690033.0] , [ 1330491600000 , 690033.0] , [ 1333166400000 , 514733.0] , [ 1335758400000 , 514733.0]]
  },
  {
    "key" : "指数",
    "values" : [ [ 1136005200000 , 71.89] , [ 1138683600000 , 75.51] , [ 1141102800000 , 68.49] , [ 1143781200000 , 62.72] , [ 1146369600000 , 70.39] , [ 1149048000000 , 59.77] , [ 1151640000000 , 57.27] , [ 1154318400000 , 67.96] , [ 1156996800000 , 67.85] , [ 1159588800000 , 76.98] , [ 1162270800000 , 81.08] , [ 1164862800000 , 91.66] , [ 1167541200000 , 84.84] , [ 1170219600000 , 85.73] , [ 1172638800000 , 84.61] , [ 1175313600000 , 92.91] , [ 1177905600000 , 99.8] , [ 1180584000000 , 121.191] , [ 1183176000000 , 122.04] , [ 1185854400000 , 131.76] , [ 1188532800000 , 138.48] , [ 1191124800000 , 153.47] , [ 1193803200000 , 189.95] , [ 1196398800000 , 182.22] , [ 1199077200000 , 198.08] , [ 1201755600000 , 135.36] , [ 1204261200000 , 125.02] , [ 1206936000000 , 143.5] , [ 1209528000000 , 173.95] , [ 1212206400000 , 188.75] , [ 1214798400000 , 167.44] , [ 1217476800000 , 158.95] , [ 1220155200000 , 169.53] , [ 1222747200000 , 113.66] , [ 1225425600000 , 107.59] , [ 1228021200000 , 92.67] , [ 1230699600000 , 85.35] , [ 1233378000000 , 90.13] , [ 1235797200000 , 89.31] , [ 1238472000000 , 105.12] , [ 1241064000000 , 125.83] , [ 1243742400000 , 135.81] , [ 1246334400000 , 142.43] , [ 1249012800000 , 163.39] , [ 1251691200000 , 168.21] , [ 1254283200000 , 185.35] , [ 1256961600000 , 188.5] , [ 1259557200000 , 199.91] , [ 1262235600000 , 210.732] , [ 1264914000000 , 192.063] , [ 1267333200000 , 204.62] , [ 1270008000000 , 235.0] , [ 1272600000000 , 261.09] , [ 1275278400000 , 256.88] , [ 1277870400000 , 251.53] , [ 1280548800000 , 257.25] , [ 1283227200000 , 243.1] , [ 1285819200000 , 283.75] , [ 1288497600000 , 300.98] , [ 1291093200000 , 311.15] , [ 1293771600000 , 322.56] , [ 1296450000000 , 339.32] , [ 1298869200000 , 353.21] , [ 1301544000000 , 348.5075] , [ 1304136000000 , 350.13] , [ 1306814400000 , 347.83] , [ 1309406400000 , 335.67] , [ 1312084800000 , 390.48] , [ 1314763200000 , 384.83] , [ 1317355200000 , 381.32] , [ 1320033600000 , 404.78] , [ 1322629200000 , 382.2] , [ 1325307600000 , 405.0] , [ 1327986000000 , 456.48] , [ 1330491600000 , 542.44] , [ 1333166400000 , 599.55] , [ 1335758400000 , 583.98]]
  }
];

var targetLineChart = [
  {
    "key": "Series 1",
    "values": [ [ 1025409600000 , 0] , [ 1028088000000 , -6.3382185140371] , [ 1030766400000 , -5.9507873460847] , [ 1033358400000 , -11.569146943813] , [ 1036040400000 , -5.4767332317425] , [ 1038632400000 , 0.50794682203014] , [ 1041310800000 , -5.5310285460542] , [ 1043989200000 , -5.7838296963382] , [ 1046408400000 , -7.3249341615649] , [ 1049086800000 , -6.7078630712489] , [ 1051675200000 , 0.44227126150934] , [ 1054353600000 , 7.2481659343222] , [ 1056945600000 , 9.2512381306992] , [ 1059624000000 , 11.341210982529] , [ 1062302400000 , 14.734820409020] , [ 1064894400000 , 12.387148007542] , [ 1067576400000 , 18.436471461827] , [ 1070168400000 , 19.830742266977] , [ 1072846800000 , 22.643205829887] , [ 1075525200000 , 26.743156781239] , [ 1078030800000 , 29.597478802228] , [ 1080709200000 , 30.831697585341] , [ 1083297600000 , 28.054068024708] , [ 1085976000000 , 29.294079423832] , [ 1088568000000 , 30.269264061274] , [ 1091246400000 , 24.934526898906] , [ 1093924800000 , 24.265982759406] , [ 1096516800000 , 27.217794897473] , [ 1099195200000 , 30.802601992077] , [ 1101790800000 , 36.331003758254] , [ 1104469200000 , 43.142498700060] , [ 1107147600000 , 40.558263931958] , [ 1109566800000 , 42.543622385800] , [ 1112245200000 , 41.683584710331] , [ 1114833600000 , 36.375367302328] , [ 1117512000000 , 40.719688980730] , [ 1120104000000 , 43.897963036919] , [ 1122782400000 , 49.797033975368] , [ 1125460800000 , 47.085993935989] , [ 1128052800000 , 46.601972859745] , [ 1130734800000 , 41.567784572762] , [ 1133326800000 , 47.296923737245] , [ 1136005200000 , 47.642969612080] , [ 1138683600000 , 50.781515820954] , [ 1141102800000 , 52.600229204305] , [ 1143781200000 , 55.599684490628] , [ 1146369600000 , 57.920388436633] , [ 1149048000000 , 53.503593218971] , [ 1151640000000 , 53.522973979964] , [ 1154318400000 , 49.846822298548] , [ 1156996800000 , 54.721341614650] , [ 1159588800000 , 58.186236223191] , [ 1162270800000 , 63.908065540997] , [ 1164862800000 , 69.767285129367] , [ 1167541200000 , 72.534013373592] , [ 1170219600000 , 77.991819436573] , [ 1172638800000 , 78.143584404990] , [ 1175313600000 , 83.702398665233] , [ 1177905600000 , 91.140859312418] , [ 1180584000000 , 98.590960607028] , [ 1183176000000 , 96.245634754228] , [ 1185854400000 , 92.326364432615] , [ 1188532800000 , 97.068765332230] , [ 1191124800000 , 105.81025556260] , [ 1193803200000 , 114.38348777791] , [ 1196398800000 , 103.59604949810] , [ 1199077200000 , 101.72488429307] , [ 1201755600000 , 89.840147735028] , [ 1204261200000 , 86.963597532664] , [ 1206936000000 , 84.075505208491] , [ 1209528000000 , 93.170105645831] , [ 1212206400000 , 103.62838083121] , [ 1214798400000 , 87.458241365091] , [ 1217476800000 , 85.808374141319] , [ 1220155200000 , 93.158054469193] , [ 1222747200000 , 65.973252382360] , [ 1225425600000 , 44.580686638224] , [ 1228021200000 , 36.418977140128] , [ 1230699600000 , 38.727678144761] , [ 1233378000000 , 36.692674173387] , [ 1235797200000 , 30.033022809480] , [ 1238472000000 , 36.707532162718] , [ 1241064000000 , 52.191457688389] , [ 1243742400000 , 56.357883979735] , [ 1246334400000 , 57.629002180305] , [ 1249012800000 , 66.650985790166] , [ 1251691200000 , 70.839243432186] , [ 1254283200000 , 78.731998491499] , [ 1256961600000 , 72.375528540349] , [ 1259557200000 , 81.738387881630] , [ 1262235600000 , 87.539792394232] , [ 1264914000000 , 84.320762662273] , [ 1267333200000 , 90.621278391889] , [ 1270008000000 , 102.47144881651] , [ 1272600000000 , 102.79320353429] , [ 1275278400000 , 90.529736050479] , [ 1277870400000 , 76.580859994531] , [ 1280548800000 , 86.548979376972] , [ 1283227200000 , 81.879653334089] , [ 1285819200000 , 101.72550015956] , [ 1288497600000 , 107.97964852260] , [ 1291093200000 , 106.16240630785] , [ 1293771600000 , 114.84268599533] , [ 1296450000000 , 121.60793322282] , [ 1298869200000 , 133.41437346605] , [ 1301544000000 , 125.46646042904] , [ 1304136000000 , 129.76784954301] , [ 1306814400000 , 128.15798861044] , [ 1309406400000 , 121.92388706072] , [ 1312084800000 , 116.70036100870] , [ 1314763200000 , 88.367701837033] , [ 1317355200000 , 59.159665765725] , [ 1320033600000 , 79.793568139753] , [ 1322629200000 , 75.903834028417] , [ 1325307600000 , 72.704218209157] , [ 1327986000000 , 84.936990804097] , [ 1330491600000 , 93.388148670744]]
  },
  {
    "key": "Series 2",
    "values": [ [ 1025409600000 , 0] , [ 1028088000000 , 0] , [ 1030766400000 , 0] , [ 1033358400000 , 0] , [ 1036040400000 , 0] , [ 1038632400000 , 0] , [ 1041310800000 , 0] , [ 1043989200000 , 0] , [ 1046408400000 , 0] , [ 1049086800000 , 0] , [ 1051675200000 , 0] , [ 1054353600000 , 0] , [ 1056945600000 , 0] , [ 1059624000000 , 0] , [ 1062302400000 , 0] , [ 1064894400000 , 0] , [ 1067576400000 , 0] , [ 1070168400000 , 0] , [ 1072846800000 , 0] , [ 1075525200000 , -0.049184266875945] , [ 1078030800000 , -0.10757569491991] , [ 1080709200000 , -0.075601531307242] , [ 1083297600000 , -0.061245277988149] , [ 1085976000000 , -0.068227316401169] , [ 1088568000000 , -0.11242758058502] , [ 1091246400000 , -0.074848439408270] , [ 1093924800000 , -0.11465623676497] , [ 1096516800000 , -0.24370633342416] , [ 1099195200000 , -0.21523268478893] , [ 1101790800000 , -0.37859370911822] , [ 1104469200000 , -0.41932884345151] , [ 1107147600000 , -0.45393735984802] , [ 1109566800000 , -0.50868179522598] , [ 1112245200000 , -0.48164396881207] , [ 1114833600000 , -0.41605962887194] , [ 1117512000000 , -0.48490348490240] , [ 1120104000000 , -0.55071036101311] , [ 1122782400000 , -0.67489170505394] , [ 1125460800000 , -0.74978070939342] , [ 1128052800000 , -0.86395050745343] , [ 1130734800000 , -0.78524898506764] , [ 1133326800000 , -0.99800440950854] , [ 1136005200000 , -1.1177951153878] , [ 1138683600000 , -1.4119975432964] , [ 1141102800000 , -1.2409959736465] , [ 1143781200000 , -1.3088936375431] , [ 1146369600000 , -1.5495785469683] , [ 1149048000000 , -1.1563414981293] , [ 1151640000000 , -0.87192471725994] , [ 1154318400000 , -0.84073995183442] , [ 1156996800000 , -0.88761892867370] , [ 1159588800000 , -0.81748513917485] , [ 1162270800000 , -1.2874081041274] , [ 1164862800000 , -1.9234702981339] , [ 1167541200000 , -1.8377768147648] , [ 1170219600000 , -2.7107654031830] , [ 1172638800000 , -2.6493268125418] , [ 1175313600000 , -3.0814553134551] , [ 1177905600000 , -3.8509837783574] , [ 1180584000000 , -5.2919167850718] , [ 1183176000000 , -5.2297750650773] , [ 1185854400000 , -3.9335668501451] , [ 1188532800000 , -2.3695525190114] , [ 1191124800000 , -2.3084243151854] , [ 1193803200000 , -3.0753680726738] , [ 1196398800000 , -2.2346609938962] , [ 1199077200000 , -3.0598810361615] , [ 1201755600000 , -1.8410154270386] , [ 1204261200000 , -1.6479442038620] , [ 1206936000000 , -1.9293858622780] , [ 1209528000000 , -3.0769590460943] , [ 1212206400000 , -4.2423933501421] , [ 1214798400000 , -2.6951491617768] , [ 1217476800000 , -2.8981825939957] , [ 1220155200000 , -2.9662727940324] , [ 1222747200000 , 0.21556750497498] , [ 1225425600000 , 2.6784995167088] , [ 1228021200000 , 4.1296711248958] , [ 1230699600000 , 3.7311068218734] , [ 1233378000000 , 4.7695330866954] , [ 1235797200000 , 5.1919133040990] , [ 1238472000000 , 4.1025856045660] , [ 1241064000000 , 2.8498939666225] , [ 1243742400000 , 2.8106017222851] , [ 1246334400000 , 2.8456526669963] , [ 1249012800000 , 0.65563070754298] , [ 1251691200000 , -0.30022343874633] , [ 1254283200000 , -1.1600358228964] , [ 1256961600000 , -0.26674408835052] , [ 1259557200000 , -1.4693389757812] , [ 1262235600000 , -2.7855421590594] , [ 1264914000000 , -1.2668244065703] , [ 1267333200000 , -2.5537804115548] , [ 1270008000000 , -4.9144552474502] , [ 1272600000000 , -6.0484408234831] , [ 1275278400000 , -3.3834349033750] , [ 1277870400000 , -0.46752826932523] , [ 1280548800000 , -1.8030186027963] , [ 1283227200000 , -0.99623230097881] , [ 1285819200000 , -3.3475370235594] , [ 1288497600000 , -3.8187026520342] , [ 1291093200000 , -4.2354146250353] , [ 1293771600000 , -5.6795404292885] , [ 1296450000000 , -6.2928665328172] , [ 1298869200000 , -6.8549277434419] , [ 1301544000000 , -6.9925308360918] , [ 1304136000000 , -8.3216548655839] , [ 1306814400000 , -7.7682867271435] , [ 1309406400000 , -6.9244213301058] , [ 1312084800000 , -5.7407624451404] , [ 1314763200000 , -2.1813149077927] , [ 1317355200000 , 2.9407596325999] , [ 1320033600000 , -1.1130607112134] , [ 1322629200000 , -2.0274822307752] , [ 1325307600000 , -1.8372559072154] , [ 1327986000000 , -4.0732815531148] , [ 1330491600000 , -6.4417038470291]]
  },
  {
    "key": "Series 3",
    "values": [ [ 1025409600000 , 0] , [ 1028088000000 , -6.3382185140371] , [ 1030766400000 , -5.9507873460847] , [ 1033358400000 , -11.569146943813] , [ 1036040400000 , -5.4767332317425] , [ 1038632400000 , 0.50794682203014] , [ 1041310800000 , -5.5310285460542] , [ 1043989200000 , -5.7838296963382] , [ 1046408400000 , -7.3249341615649] , [ 1049086800000 , -6.7078630712489] , [ 1051675200000 , 0.44227126150934] , [ 1054353600000 , 7.2481659343222] , [ 1056945600000 , 9.2512381306992] , [ 1059624000000 , 11.341210982529] , [ 1062302400000 , 14.734820409020] , [ 1064894400000 , 12.387148007542] , [ 1067576400000 , 18.436471461827] , [ 1070168400000 , 19.830742266977] , [ 1072846800000 , 22.643205829887] , [ 1075525200000 , 26.693972514363] , [ 1078030800000 , 29.489903107308] , [ 1080709200000 , 30.756096054034] , [ 1083297600000 , 27.992822746720] , [ 1085976000000 , 29.225852107431] , [ 1088568000000 , 30.156836480689] , [ 1091246400000 , 24.859678459498] , [ 1093924800000 , 24.151326522641] , [ 1096516800000 , 26.974088564049] , [ 1099195200000 , 30.587369307288] , [ 1101790800000 , 35.952410049136] , [ 1104469200000 , 42.723169856608] , [ 1107147600000 , 40.104326572110] , [ 1109566800000 , 42.034940590574] , [ 1112245200000 , 41.201940741519] , [ 1114833600000 , 35.959307673456] , [ 1117512000000 , 40.234785495828] , [ 1120104000000 , 43.347252675906] , [ 1122782400000 , 49.122142270314] , [ 1125460800000 , 46.336213226596] , [ 1128052800000 , 45.738022352292] , [ 1130734800000 , 40.782535587694] , [ 1133326800000 , 46.298919327736] , [ 1136005200000 , 46.525174496692] , [ 1138683600000 , 49.369518277658] , [ 1141102800000 , 51.359233230659] , [ 1143781200000 , 54.290790853085] , [ 1146369600000 , 56.370809889665] , [ 1149048000000 , 52.347251720842] , [ 1151640000000 , 52.651049262704] , [ 1154318400000 , 49.006082346714] , [ 1156996800000 , 53.833722685976] , [ 1159588800000 , 57.368751084016] , [ 1162270800000 , 62.620657436870] , [ 1164862800000 , 67.843814831233] , [ 1167541200000 , 70.696236558827] , [ 1170219600000 , 75.281054033390] , [ 1172638800000 , 75.494257592448] , [ 1175313600000 , 80.620943351778] , [ 1177905600000 , 87.289875534061] , [ 1180584000000 , 93.299043821956] , [ 1183176000000 , 91.015859689151] , [ 1185854400000 , 88.392797582470] , [ 1188532800000 , 94.699212813219] , [ 1191124800000 , 103.50183124741] , [ 1193803200000 , 111.30811970524] , [ 1196398800000 , 101.36138850420] , [ 1199077200000 , 98.665003256909] , [ 1201755600000 , 87.999132307989] , [ 1204261200000 , 85.315653328802] , [ 1206936000000 , 82.146119346213] , [ 1209528000000 , 90.093146599737] , [ 1212206400000 , 99.385987481068] , [ 1214798400000 , 84.763092203314] , [ 1217476800000 , 82.910191547323] , [ 1220155200000 , 90.191781675161] , [ 1222747200000 , 66.188819887335] , [ 1225425600000 , 47.259186154933] , [ 1228021200000 , 40.548648265024] , [ 1230699600000 , 42.458784966634] , [ 1233378000000 , 41.462207260082] , [ 1235797200000 , 35.224936113579] , [ 1238472000000 , 40.810117767284] , [ 1241064000000 , 55.041351655012] , [ 1243742400000 , 59.168485702020] , [ 1246334400000 , 60.474654847301] , [ 1249012800000 , 67.306616497709] , [ 1251691200000 , 70.539019993440] , [ 1254283200000 , 77.571962668603] , [ 1256961600000 , 72.108784451998] , [ 1259557200000 , 80.269048905849] , [ 1262235600000 , 84.754250235173] , [ 1264914000000 , 83.053938255703] , [ 1267333200000 , 88.067497980334] , [ 1270008000000 , 97.556993569060] , [ 1272600000000 , 96.744762710807] , [ 1275278400000 , 87.146301147104] , [ 1277870400000 , 76.113331725206] , [ 1280548800000 , 84.745960774176] , [ 1283227200000 , 80.883421033110] , [ 1285819200000 , 98.377963136001] , [ 1288497600000 , 104.16094587057] , [ 1291093200000 , 101.92699168281] , [ 1293771600000 , 109.16314556604] , [ 1296450000000 , 115.31506669000] , [ 1298869200000 , 126.55944572261] , [ 1301544000000 , 118.47392959295] , [ 1304136000000 , 121.44619467743] , [ 1306814400000 , 120.38970188330] , [ 1309406400000 , 114.99946573061] , [ 1312084800000 , 110.95959856356] , [ 1314763200000 , 86.186386929240] , [ 1317355200000 , 62.100425398325] , [ 1320033600000 , 78.680507428540] , [ 1322629200000 , 73.876351797642] , [ 1325307600000 , 70.866962301942] , [ 1327986000000 , 80.863709250982] , [ 1330491600000 , 86.946444823715]]
  },
  {
    "key": "Series 4",
    "values": [ [ 1025409600000 , -7.0674410638835] , [ 1028088000000 , -14.663359292964] , [ 1030766400000 , -14.104393060540] , [ 1033358400000 , -23.114477037218] , [ 1036040400000 , -16.774256687841] , [ 1038632400000 , -11.902028464000] , [ 1041310800000 , -16.883038668422] , [ 1043989200000 , -19.104223676831] , [ 1046408400000 , -20.420523282736] , [ 1049086800000 , -19.660555051587] , [ 1051675200000 , -13.106911231646] , [ 1054353600000 , -8.2448460302143] , [ 1056945600000 , -7.0313058730976] , [ 1059624000000 , -5.1485118700389] , [ 1062302400000 , -3.0011028761469] , [ 1064894400000 , -4.1367265281467] , [ 1067576400000 , 1.5425209565025] , [ 1070168400000 , 2.7673533607299] , [ 1072846800000 , 7.7077114755360] , [ 1075525200000 , 9.7565015112434] , [ 1078030800000 , 11.396888609473] , [ 1080709200000 , 10.013964745578] , [ 1083297600000 , 8.0558890950562] , [ 1085976000000 , 9.6081966657458] , [ 1088568000000 , 11.918590426432] , [ 1091246400000 , 7.9945345523982] , [ 1093924800000 , 8.3201276776796] , [ 1096516800000 , 9.8283954846342] , [ 1099195200000 , 11.527125859650] , [ 1101790800000 , 16.413657596527] , [ 1104469200000 , 20.393798297928] , [ 1107147600000 , 17.456308413907] , [ 1109566800000 , 20.087778400999] , [ 1112245200000 , 17.988336990817] , [ 1114833600000 , 15.378490151331] , [ 1117512000000 , 19.474322935730] , [ 1120104000000 , 20.013851070354] , [ 1122782400000 , 24.749943726975] , [ 1125460800000 , 23.558710274826] , [ 1128052800000 , 24.558915040889] , [ 1130734800000 , 22.355860488034] , [ 1133326800000 , 27.138026265756] , [ 1136005200000 , 27.202220808591] , [ 1138683600000 , 31.219437344964] , [ 1141102800000 , 31.392355525125] , [ 1143781200000 , 33.373099232542] , [ 1146369600000 , 35.095277582309] , [ 1149048000000 , 30.923356507615] , [ 1151640000000 , 31.083717332561] , [ 1154318400000 , 31.290690671561] , [ 1156996800000 , 34.247769216679] , [ 1159588800000 , 37.411073177620] , [ 1162270800000 , 42.079177096411] , [ 1164862800000 , 44.978191659648] , [ 1167541200000 , 46.713271025310] , [ 1170219600000 , 49.203892437699] , [ 1172638800000 , 46.684723471826] , [ 1175313600000 , 48.385458973500] , [ 1177905600000 , 54.660197840305] , [ 1180584000000 , 60.311838415602] , [ 1183176000000 , 57.583282204682] , [ 1185854400000 , 52.425398898751] , [ 1188532800000 , 54.663538086985] , [ 1191124800000 , 60.181844325224] , [ 1193803200000 , 62.877219773621] , [ 1196398800000 , 55.760611512951] , [ 1199077200000 , 54.735280367784] , [ 1201755600000 , 45.495912959474] , [ 1204261200000 , 40.934919015876] , [ 1206936000000 , 40.303777633187] , [ 1209528000000 , 47.403740368773] , [ 1212206400000 , 49.951960898839] , [ 1214798400000 , 37.534590035098] , [ 1217476800000 , 36.405758293321] , [ 1220155200000 , 38.545373001858] , [ 1222747200000 , 26.106358664455] , [ 1225425600000 , 4.2658006768744] , [ 1228021200000 , -3.5517839867557] , [ 1230699600000 , -2.0878920761513] , [ 1233378000000 , -10.408879093829] , [ 1235797200000 , -19.924242196038] , [ 1238472000000 , -12.906491912782] , [ 1241064000000 , -3.9774866468346] , [ 1243742400000 , 1.0319171601402] , [ 1246334400000 , 1.3109350357718] , [ 1249012800000 , 9.1668309061935] , [ 1251691200000 , 13.121178985954] , [ 1254283200000 , 17.578680237511] , [ 1256961600000 , 14.971294355085] , [ 1259557200000 , 21.551327027338] , [ 1262235600000 , 24.592328423819] , [ 1264914000000 , 20.158087829555] , [ 1267333200000 , 24.135661929185] , [ 1270008000000 , 31.815205405903] , [ 1272600000000 , 34.389524768466] , [ 1275278400000 , 23.785555857522] , [ 1277870400000 , 17.082756649072] , [ 1280548800000 , 25.248007727100] , [ 1283227200000 , 19.415179069165] , [ 1285819200000 , 30.413636349327] , [ 1288497600000 , 35.357952964550] , [ 1291093200000 , 35.886413535859] , [ 1293771600000 , 45.003601951959] , [ 1296450000000 , 48.274893564020] , [ 1298869200000 , 53.562864914648] , [ 1301544000000 , 54.108274337412] , [ 1304136000000 , 58.618190111927] , [ 1306814400000 , 56.806793965598] , [ 1309406400000 , 54.135477252994] , [ 1312084800000 , 50.735258942442] , [ 1314763200000 , 42.208170945813] , [ 1317355200000 , 31.617916826724] , [ 1320033600000 , 46.492005006737] , [ 1322629200000 , 46.203116922145] , [ 1325307600000 , 47.541427643137] , [ 1327986000000 , 54.518998440993] , [ 1330491600000 , 61.099720234693]]
  }
];


var alertsPerLine =
    [
        {
            key: "告警数量",
            values: [
                {
                    "label": "一号线",
                    "value" : 29
                } ,
                {
                    "label": "二号线",
                    "value" : 10
                } ,
                {
                    "label": "三号线",
                    "value" : 32
                } ,
                {
                    "label": "四号线",
                    "value" : 196
                } ,
                {
                    "label": "五号线",
                    "value" : 10
                } ,
                {
                    "label": "六号线",
                    "value" : 98
                } ,
                {
                    "label": "七号线",
                    "value" : 13
                } ,
                {
                    "label": "八号线",
                    "value" : 5
                },
                {
                    "label": "九号线",
                    "value" : 13
                } ,
                {
                    "label": "十号线",
                    "value" : 113
                } ,
                {
                    "label": "十一号线",
                    "value" : 213
                } ,
                {
                    "label": "十二号线",
                    "value" : 313
                } ,
                {
                    "label": "十三号线",
                    "value" : 413
                }
            ]
        }
    ];

var alertsPerLevel =
  [
    {
      key: "告警数量",
      values: [
        {
          "label": "一级",
          "value" : 29
        } ,
        {
          "label": "二级",
          "value" : 10
        } ,
        {
          "label": "三级",
          "value" : 32
        },
        {
          "label": "四级",
          "value" : 32
        }
      ]
    }
  ];

function initPieChart(domName, data, title)
{
  nv.addGraph(function() {
      var chart = nv.models.pieChart()
          .x(function(d) { return d.label})
          .y(function(d) { return d.value})
          .tooltipContent(function(key, y, e, graph){return '<h3>' + key + '</h3>' +'<p>' + parseInt(y) + '</p>' ;})
          .showLabels(true)
          .showLegend(false);

      d3.select(domName)
          .datum(data)
          .transition().duration(1200)
          .call(chart); 	 

      var svg_width = 200;
      var svg_height = 310;
      d3.select(domName)
        .append("text")
        .attr("x", (svg_width / 2))
        .attr("y", svg_height)
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .style("text-decoration", "underline")
        .text(title);

      return chart;
  });
}


function sinCosData() {
  var sin = [],
    cos = [];

  for (var i = 0; i < 100; i++) {
    sin.push({x: i, y: Math.sin(i/10)});
    cos.push({x: i, y: .5 * Math.cos(i/10)});
  }

  return [
    {
      values: sin,
      key: 'Sine Wave'
    },
    {
      values: cos,
      key: 'Cosine Wave'
    }
  ];
};

function initLineChart(domName, data)
{
  nv.addGraph(function() {
    var chart = nv.models.lineChart();

    chart.xAxis
      .axisLabel('time')
      .tickFormat(d3.format(',r'));

    chart.yAxis
      .axisLabel('v')
      .tickFormat(d3.format('.02f'));

   d3.select(domName)
      .datum(sinCosData())
      .transition().duration(500)
      .call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
  });
}

function initAlertHistoryChart(domName, data)
{
  nv.addGraph(function() {
    var chart = nv.models.lineChart();

    chart.xAxis
      .axisLabel('时间(天)');
    //.tickFormat(d3.format(',r'));

    chart.yAxis
      .axisLabel('告警数');
    //.tickFormat(d3.format('.02f'));

    d3.select(domName)
      .datum(data)
      .transition().duration(500)
      .call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
  });
}

// multi bar chart

function multiBarChartData() {
  return stream_layers(3,10+Math.random()*100,.1).map(function(data, i) {
    return {
      key: 'Stream' + i,
      values: data
    };
  });
}

/* Inspired by Lee Byron's test data generator. */
function stream_layers(n, m, o) {
  if (arguments.length < 3) o = 0;
  function bump(a) {
    var x = 1 / (.1 + Math.random()),
      y = 2 * Math.random() - .5,
      z = 10 / (.1 + Math.random());
    for (var i = 0; i < m; i++) {
      var w = (i / m - y) * z;
      a[i] += x * Math.exp(-w * w);
    }
  }
  return d3.range(n).map(function() {
    var a = [], i;
    for (i = 0; i < m; i++) a[i] = o + o * Math.random();
    for (i = 0; i < 5; i++) bump(a);
    return a.map(stream_index);
  });
}

/* Another layer generator using gamma distributions. */
function stream_waves(n, m) {
  return d3.range(n).map(function(i) {
    return d3.range(m).map(function(j) {
      var x = 20 * j / m - i / 3;
      return 2 * x * Math.exp(-.5 * x);
    }).map(stream_index);
  });
}

function stream_index(d, i) {
  return {x: i, y: Math.max(0, d)};
}



function initMultiBarChart(domName)
{
  nv.addGraph(function() {
    var chart = nv.models.multiBarChart();

    chart.showControls(false);
    //chart.stacked(true);

    chart.xAxis
      .tickFormat(d3.format(',f'));

    chart.yAxis
      .tickFormat(d3.format(',.1f'));

    d3.select(domName)
      .datum(multiBarChartData())
      .transition().duration(500).call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
  });

}

function initTargetLineChart(domName)
{
  nv.addGraph(function() {
    var chart = nv.models.cumulativeLineChart()
      .x(function(d) { return d[0] })
      .y(function(d) { return d[1]}) //adjusting, 100% is 1.00, not 100 as it is in the data
      .color(d3.scale.category10().range());

     chart.xAxis
      .tickFormat(d3.format(',f'));

    chart.yAxis
      .tickFormat(d3.format(',.1f'));

    d3.select(domName)
      .datum(targetLineChart)
      .transition().duration(500)
      .call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
  });
}

function initReportTrend(domName)
{
  nv.addGraph(function() {
    var chart = nv.models.linePlusBarChart()
      .margin({top: 30, right: 60, bottom: 50, left: 70})
      .x(function(d,i) { return i })
      .y(function(d) { return d[1] })
      .color(d3.scale.category10().range());

    chart.xAxis
      .showMaxMin(false)
      .tickFormat(function(d) {
        var dx = data[0].values[d] && data[0].values[d][0] || 0;
        return d3.time.format('%x')(new Date(dx))
      });

    chart.y1Axis
      .tickFormat(d3.format(',f'));

    chart.y2Axis
      .tickFormat(function(d) { return '$' + d3.format(',f')(d) });

    chart.bars.forceY([0]);

    d3.select(domName)
      .datum(reportTrend)
      .transition().duration(500).call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
  });
}






function GetAllCheckedAlarms()
{
  var table_id = 'query_result_table';
  var table = document.getElementById(table_id);
  var table_body = table.tBodies[0];
  var result = [];
  var i, row, cell;
  for (i = 0; row = table_body.rows[i]; i++) {
    cell = row.cells[1];
    if ( (cell.childNodes.length > 0)
      && (cell.childNodes[0].nodeName == 'INPUT')
      &&  (cell.childNodes[0].type == "checkbox")
      && (cell.childNodes[0].disabled == false)
      && (cell.childNodes[0].checked == true))
    {
      result.push(row.cells[3].childNodes[0].textContent);
    }
  }
  return result;
}




function ProcessAlarms(alarms)
{
  var request = {"action":"confirm","ids":alarms};
  var Url="/Rcm/Manage/warningOperate.do";
  PostJSONQuery(Url,request,
    function(response){
      OnMainPageQuery();
      document.location = '/alert/current_process_selector';
    });
}

/**取消告警*/
function OnCancelAlarm(){
	var ids = document.getElementsByName("needitems");   
	var obj=[];
    for(var i=0;i<ids.length;i++){ 
    	var count=0;
        if(ids[i].checked){
        	obj.push(ids[i].id);
        	count++;
        }
    } 
    CancelAlarms(obj);
    OnOperativeIndexUpdate();
}

function CancelAlarms(alarms)
{
	if(confirm("确定要删除该告警吗?")){
		 var request = {"action":"cancel","ids":alarms};
		 var Url="/Rcm/Manage/warningOperate.do";
		  PostJSONQuery(Url,request,
		    function(response){
			  var nowpage= $('#main_page_nowpage')[0].innerHTML;
			  selectData(nowpage);
		    });
	}
 
}
//-----------------------------------------首页的即时刷新---------------------------------------------------------//

function  mainpageFlush(){
	window.setInterval(function(){

		var sendSignal_json={"setting":"getting"};
		
		 var Url="/Rcm/Manage/getInfoFromFlag.do";
	PostJSONQuery(Url,sendSignal_json,
		function(response){
		if(response.info=="success"){
			//调用首页的所有方法
			
			OnOperativeIndexUpdate();
			
      		OnMainPageQuery();
 			
        	showimportmentSomething();
        	
        	setParameterToServer();
			
		}
		
	});	
	},20000);
	
	
	
	
}
//设置给服务端返回的状态参数
function  setParameterToServer(){
	var  setState_json={"setting":"setting"};
	var Url="/Rcm/Manage/setInfoFromFlag.do";
	PostJSONQuery(Url,setState_json,function(response){
		
	});
	
}


/****一条线的每一小时取得健康指数****/
var line_Health={
	    "infoList": [
	                 {
	                     "savetime": 1385395200000000,
	                     "value": 80
	                 },
	                 {
	                     "savetime": 1385398800000000,
	                     "value": 76
	                 },
	                 {
	                     "savetime": 1385402400000000,
	                     "value": 89
	                 },
	                 {
	                     "savetime": 1385406000000000,
	                     "value": 90
	                 },
	                 {
	                     "savetime": 1385409600000000,
	                     "value": 95
	                 },
	                 {
	                     "savetime": 1385413200000000,
	                     "value": 94
	                 },
	                 {
	                     "savetime": 1385416800000000,
	                     "value": 80
	                 },
	                 {
	                     "savetime": 1385420400000000,
	                     "value": 80
	                 },
	                 {
	                     "savetime": 1385424000000000,
	                     "value": 90
	                 },
	                 {
	                     "savetime": 1385427600000000,
	                     "value": 80
	                 },
	                 {
	                     "savetime": 1385431200000000,
	                     "value": 85
	                 },
	                 {
	                     "savetime": 1385434800000000,
	                     "value": 85
	                 },
	                 {
	                     "savetime": 1385438400000000,
	                     "value": 88
	                 },
	                 {
	                     "savetime": 1385442000000000,
	                     "value": 90
	                 },
	                 {
	                     "savetime": 1385445600000000,
	                     "value": 100
	                 },
	                 {
	                     "savetime": 1385449200000000,
	                     "value": 90
	                 },
	                 {
	                     "savetime": 1385452800000000,
	                     "value": 95
	                 },
	                 {
	                     "savetime": 1385456400000000,
	                     "value": 95
	                 },
	                 {
	                     "savetime": 1385460000000000,
	                     "value": 97
	                 },
	                 {
	                     "savetime": 1385463600000000,
	                     "value": 88
	                 },
	                 {
	                     "savetime": 1385467200000000,
	                     "value": 77
	                 },
	                 {
	                     "savetime": 1385470800000000,
	                     "value": 90
	                 },
	                 {
	                     "savetime": 1385474400000000,
	                     "value": 90
	                 },
	                 {
	                     "savetime": 1385478000000000,
	                     "value": 96
	                 }
	             ]
	         };
function showHealthLine(){
		var result = [];
        var target_per_day = {};
        target_per_day.key = "";
        target_per_day.values = [];
        line_Health.infoList.forEach(
          function(elementCount,indexCount){
            target_per_day.values[indexCount] =[elementCount.savetime,elementCount.value];
           if (isNaN(target_per_day.values[indexCount][1]))
            {
              target_per_day.values[indexCount][1] = 0;
            }
          });
     
        	result[0] = target_per_day;
        	
        	showTendChart("#showLineHealth svg", result);
		
}
function showTendChart(domName,data)
{
  nv.addGraph(function() {
    var chart = nv.models.lineChart().
    x(function(d) { return d[0] ;})
      .y(function(d) { return d[1];})
      .color(d3.scale.category10().range());

    chart.xAxis
      .axisLabel('时间(t)')
      .tickFormat(function(d) {
        return d3.time.format('%H:%M:%S')(new Date(d));
      });
	
    chart.yAxis
    .axisLabel('健康指数')
      .tickFormat(d3.format('.02f'));
    
    d3.select(domName)
      .datum(data)
      .transition().duration(500)
      .call(chart);
	
    
    nv.utils.windowResize(chart.update);

    return chart;
  });
}




